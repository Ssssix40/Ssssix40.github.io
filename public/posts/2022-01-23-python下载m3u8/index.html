<!doctype html>
<html lang="zh-Hans">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/images/favicon.png" />

<title>python下载m3u8&nbsp;|&nbsp;spiritshaman</title>
<meta
  name="title"
  content="python下载m3u8"
/>
<meta
  name="description"
  content="ps: 本文前提是获得了m3u8_url，同时该url没有进行任何加密。
单线程下载 1import requests 2import os 3# from subprocess import run 4 5 6# 创建相应的文件夹 7if not os.path.exists(&#39;download&#39;): 8 os.mkdir(&#39;download&#39;) 9 10if not os.path.exists(&#39;download/m3u8&#39;): 11 os.mkdir(&#39;download/m3u8&#39;) 12 13if not os.path.exists(&#39;download/temp&#39;): 14 os.mkdir(&#39;download/temp&#39;) 15 16 17def download(medianame, m3u8_url): 18 headers = { 19 &#39;user-agent&#39;: 20 &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36&#39; 21 } 22 url = &#39;/&#39;.join(m3u8_url.split(&#39;/&#39;)[:-1]) &#43; &#39;/&#39; 23 with open(&#39;download/m3u8/&#39; &#43; medianame &#43; &#39;."
/>
<meta
  name="keywords"
  content="Tutorials,"
/>

  <meta name="author" content="SpiritShaman" />




<meta property="og:title" content="python下载m3u8" />
<meta property="og:description" content="ps: 本文前提是获得了m3u8_url，同时该url没有进行任何加密。
单线程下载 1import requests 2import os 3# from subprocess import run 4 5 6# 创建相应的文件夹 7if not os.path.exists(&#39;download&#39;): 8 os.mkdir(&#39;download&#39;) 9 10if not os.path.exists(&#39;download/m3u8&#39;): 11 os.mkdir(&#39;download/m3u8&#39;) 12 13if not os.path.exists(&#39;download/temp&#39;): 14 os.mkdir(&#39;download/temp&#39;) 15 16 17def download(medianame, m3u8_url): 18 headers = { 19 &#39;user-agent&#39;: 20 &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36&#39; 21 } 22 url = &#39;/&#39;.join(m3u8_url.split(&#39;/&#39;)[:-1]) &#43; &#39;/&#39; 23 with open(&#39;download/m3u8/&#39; &#43; medianame &#43; &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/2022-01-23-python%E4%B8%8B%E8%BD%BDm3u8/" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="spiritshaman" />





<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="python下载m3u8"/>
<meta name="twitter:description" content="ps: 本文前提是获得了m3u8_url，同时该url没有进行任何加密。
单线程下载 1import requests 2import os 3# from subprocess import run 4 5 6# 创建相应的文件夹 7if not os.path.exists(&#39;download&#39;): 8 os.mkdir(&#39;download&#39;) 9 10if not os.path.exists(&#39;download/m3u8&#39;): 11 os.mkdir(&#39;download/m3u8&#39;) 12 13if not os.path.exists(&#39;download/temp&#39;): 14 os.mkdir(&#39;download/temp&#39;) 15 16 17def download(medianame, m3u8_url): 18 headers = { 19 &#39;user-agent&#39;: 20 &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36&#39; 21 } 22 url = &#39;/&#39;.join(m3u8_url.split(&#39;/&#39;)[:-1]) &#43; &#39;/&#39; 23 with open(&#39;download/m3u8/&#39; &#43; medianame &#43; &#39;."/>




<meta itemprop="name" content="python下载m3u8">
<meta itemprop="description" content="ps: 本文前提是获得了m3u8_url，同时该url没有进行任何加密。
单线程下载 1import requests 2import os 3# from subprocess import run 4 5 6# 创建相应的文件夹 7if not os.path.exists(&#39;download&#39;): 8 os.mkdir(&#39;download&#39;) 9 10if not os.path.exists(&#39;download/m3u8&#39;): 11 os.mkdir(&#39;download/m3u8&#39;) 12 13if not os.path.exists(&#39;download/temp&#39;): 14 os.mkdir(&#39;download/temp&#39;) 15 16 17def download(medianame, m3u8_url): 18 headers = { 19 &#39;user-agent&#39;: 20 &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36&#39; 21 } 22 url = &#39;/&#39;.join(m3u8_url.split(&#39;/&#39;)[:-1]) &#43; &#39;/&#39; 23 with open(&#39;download/m3u8/&#39; &#43; medianame &#43; &#39;.">

<meta itemprop="wordCount" content="479">
<meta itemprop="keywords" content="Tutorials," />
<meta name="referrer" content="no-referrer-when-downgrade" />

    
    
    
    <link href="/bundle.min.css" rel="stylesheet" />

    

    


    
</head>

  <body>
    <header>
      <nav>
  <a
    href="/"
    
    >Home</a
  >

  <a
    href=""
    
    >Blog</a
  >


  <a href="/index.xml">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 448 512">
      
      <path
        d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"
      />
    </svg>
    RSS
  </a>

</nav>

<h1>python下载m3u8</h1>


    </header>
    <main>
      
  
  
  <content>
    <p>ps: 本文前提是获得了m3u8_url，同时该url没有进行任何加密。</p>
<h2 id="单线程下载">单线程下载</h2>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#94e2d5">import</span> <span style="color:#fab387">requests</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#94e2d5">import</span> <span style="color:#fab387">os</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#6c7086;font-style:italic"># from subprocess import run</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#6c7086;font-style:italic"># 创建相应的文件夹</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#cba6f7">if</span> <span style="color:#89dceb;font-weight:bold">not</span> os<span style="color:#89dceb;font-weight:bold">.</span>path<span style="color:#89dceb;font-weight:bold">.</span>exists(<span style="color:#a6e3a1">&#39;download&#39;</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>    os<span style="color:#89dceb;font-weight:bold">.</span>mkdir(<span style="color:#a6e3a1">&#39;download&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#cba6f7">if</span> <span style="color:#89dceb;font-weight:bold">not</span> os<span style="color:#89dceb;font-weight:bold">.</span>path<span style="color:#89dceb;font-weight:bold">.</span>exists(<span style="color:#a6e3a1">&#39;download/m3u8&#39;</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>    os<span style="color:#89dceb;font-weight:bold">.</span>mkdir(<span style="color:#a6e3a1">&#39;download/m3u8&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span><span style="color:#cba6f7">if</span> <span style="color:#89dceb;font-weight:bold">not</span> os<span style="color:#89dceb;font-weight:bold">.</span>path<span style="color:#89dceb;font-weight:bold">.</span>exists(<span style="color:#a6e3a1">&#39;download/temp&#39;</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>    os<span style="color:#89dceb;font-weight:bold">.</span>mkdir(<span style="color:#a6e3a1">&#39;download/temp&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span><span style="color:#cba6f7">def</span> <span style="color:#89b4fa">download</span>(medianame, m3u8_url):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>    headers <span style="color:#89dceb;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>        <span style="color:#a6e3a1">&#39;user-agent&#39;</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>        <span style="color:#a6e3a1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>    url <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#a6e3a1">&#39;/&#39;</span><span style="color:#89dceb;font-weight:bold">.</span>join(m3u8_url<span style="color:#89dceb;font-weight:bold">.</span>split(<span style="color:#a6e3a1">&#39;/&#39;</span>)[:<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#fab387">1</span>]) <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;/&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>    <span style="color:#cba6f7">with</span> <span style="color:#89dceb">open</span>(<span style="color:#a6e3a1">&#39;download/m3u8/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.m3u8&#39;</span>, <span style="color:#a6e3a1">&#39;wb&#39;</span>) <span style="color:#cba6f7">as</span> f:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>        r <span style="color:#89dceb;font-weight:bold">=</span> requests<span style="color:#89dceb;font-weight:bold">.</span>get(m3u8_url, headers<span style="color:#89dceb;font-weight:bold">=</span>headers)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>        f<span style="color:#89dceb;font-weight:bold">.</span>write(r<span style="color:#89dceb;font-weight:bold">.</span>content)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>    line <span style="color:#89dceb;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>    <span style="color:#cba6f7">for</span> i <span style="color:#89dceb;font-weight:bold">in</span> <span style="color:#89dceb">open</span>(<span style="color:#a6e3a1">&#39;download/m3u8/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.m3u8&#39;</span>, <span style="color:#a6e3a1">&#39;r&#39;</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>        <span style="color:#cba6f7">if</span> <span style="color:#a6e3a1">&#39;#&#39;</span> <span style="color:#89dceb;font-weight:bold">in</span> i:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>            <span style="color:#cba6f7">continue</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span>        line<span style="color:#89dceb;font-weight:bold">.</span>append(i<span style="color:#89dceb;font-weight:bold">.</span>replace(<span style="color:#a6e3a1">&#39;</span><span style="color:#89b4fa">\r</span><span style="color:#a6e3a1">&#39;</span>, <span style="color:#a6e3a1">&#39;&#39;</span>)<span style="color:#89dceb;font-weight:bold">.</span>replace(<span style="color:#a6e3a1">&#39;</span><span style="color:#89b4fa">\n</span><span style="color:#a6e3a1">&#39;</span>, <span style="color:#a6e3a1">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span>    <span style="color:#89dceb">print</span>(<span style="color:#a6e3a1">&#39;开始下载!&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>    <span style="color:#cba6f7">with</span> <span style="color:#89dceb">open</span>(<span style="color:#a6e3a1">&#39;download/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.ts&#39;</span>, <span style="color:#a6e3a1">&#39;wb&#39;</span>) <span style="color:#cba6f7">as</span> f:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">35</span><span>        <span style="color:#cba6f7">for</span> i <span style="color:#89dceb;font-weight:bold">in</span> tqdm(line):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">36</span><span>            <span style="color:#6c7086;font-style:italic"># print(url+i)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">37</span><span>            r <span style="color:#89dceb;font-weight:bold">=</span> requests<span style="color:#89dceb;font-weight:bold">.</span>get(url <span style="color:#89dceb;font-weight:bold">+</span> i)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">38</span><span>            f<span style="color:#89dceb;font-weight:bold">.</span>write(r<span style="color:#89dceb;font-weight:bold">.</span>content)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">39</span><span>    <span style="color:#6c7086;font-style:italic"># print(&#39;开始转码,请等待~&#39;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">40</span><span>    <span style="color:#6c7086;font-style:italic"># run([</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">41</span><span>    <span style="color:#6c7086;font-style:italic">#     &#39;ffmpeg/bin/ffmpeg.exe&#39;, &#39;-i&#39;, &#39;download/&#39; + medianame + &#39;.ts&#39;, &#39;-c:v&#39;,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">42</span><span>    <span style="color:#6c7086;font-style:italic">#     &#39;copy&#39;, &#39;-c:a&#39;, &#39;copy&#39;, &#39;download/&#39; + medianame + &#39;.mp4&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">43</span><span>    <span style="color:#6c7086;font-style:italic"># ])</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">44</span><span>    <span style="color:#6c7086;font-style:italic"># os.remove(&#39;download/&#39; + medianame + &#39;.ts&#39;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">45</span><span>    os<span style="color:#89dceb;font-weight:bold">.</span>remove(<span style="color:#a6e3a1">&#39;download/m3u8/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.m3u8&#39;</span>)</span></span></code></pre></div>
<h2 id="多线程下载">多线程下载</h2>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#94e2d5">import</span> <span style="color:#fab387">aiohttp</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#94e2d5">import</span> <span style="color:#fab387">asyncio</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#94e2d5">import</span> <span style="color:#fab387">os</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#6c7086;font-style:italic"># from subprocess import run</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#cba6f7">def</span> <span style="color:#89b4fa">combine</span>(temp, file):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>    <span style="color:#cba6f7">with</span> <span style="color:#89dceb">open</span>(file, <span style="color:#a6e3a1">&#39;wb&#39;</span>) <span style="color:#cba6f7">as</span> f:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>        <span style="color:#89dceb">list</span> <span style="color:#89dceb;font-weight:bold">=</span> os<span style="color:#89dceb;font-weight:bold">.</span>listdir(temp)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>        <span style="color:#89dceb">list</span><span style="color:#89dceb;font-weight:bold">.</span>sort()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>        <span style="color:#cba6f7">for</span> i <span style="color:#89dceb;font-weight:bold">in</span> <span style="color:#89dceb">list</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>            <span style="color:#cba6f7">with</span> <span style="color:#89dceb">open</span>(os<span style="color:#89dceb;font-weight:bold">.</span>path<span style="color:#89dceb;font-weight:bold">.</span>join(temp, i), <span style="color:#a6e3a1">&#39;rb&#39;</span>) <span style="color:#cba6f7">as</span> t:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>                f<span style="color:#89dceb;font-weight:bold">.</span>write(t<span style="color:#89dceb;font-weight:bold">.</span>read())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#cba6f7">async</span> <span style="color:#cba6f7">def</span> <span style="color:#89b4fa">req</span>(client, url, filename, sem):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>    <span style="color:#cba6f7">async</span> <span style="color:#cba6f7">with</span> sem:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>        response <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#cba6f7">await</span> client<span style="color:#89dceb;font-weight:bold">.</span>get(url)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>        <span style="color:#cba6f7">with</span> <span style="color:#89dceb">open</span>(filename, <span style="color:#a6e3a1">&#39;wb&#39;</span>) <span style="color:#cba6f7">as</span> f:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>            f<span style="color:#89dceb;font-weight:bold">.</span>write(<span style="color:#cba6f7">await</span> response<span style="color:#89dceb;font-weight:bold">.</span>content<span style="color:#89dceb;font-weight:bold">.</span>read())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span><span style="color:#cba6f7">async</span> <span style="color:#cba6f7">def</span> <span style="color:#89b4fa">download_async</span>(medianame, m3u8_url, sem_num):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>    <span style="color:#cba6f7">if</span> <span style="color:#89dceb">int</span>(sem_num) <span style="color:#89dceb;font-weight:bold">in</span> <span style="color:#89dceb">range</span>(<span style="color:#fab387">2</span>, <span style="color:#fab387">13</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>        sem <span style="color:#89dceb;font-weight:bold">=</span> asyncio<span style="color:#89dceb;font-weight:bold">.</span>Semaphore(<span style="color:#89dceb">int</span>(sem_num))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>        <span style="color:#89dceb">print</span>(<span style="color:#a6e3a1">&#39;以</span><span style="color:#a6e3a1">%s</span><span style="color:#a6e3a1">进行下载&#39;</span> <span style="color:#89dceb;font-weight:bold">%</span> sem_num)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>    <span style="color:#cba6f7">else</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>        <span style="color:#89dceb">print</span>(<span style="color:#a6e3a1">&#39;输入不合格, 以6进行下载&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>        sem <span style="color:#89dceb;font-weight:bold">=</span> asyncio<span style="color:#89dceb;font-weight:bold">.</span>Semaphore(<span style="color:#fab387">6</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>    <span style="color:#cba6f7">async</span> <span style="color:#cba6f7">with</span> aiohttp<span style="color:#89dceb;font-weight:bold">.</span>ClientSession(connector<span style="color:#89dceb;font-weight:bold">=</span>aiohttp<span style="color:#89dceb;font-weight:bold">.</span>TCPConnector(
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span>            ssl<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">False</span>)) <span style="color:#cba6f7">as</span> session:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span>        headers <span style="color:#89dceb;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span>            <span style="color:#a6e3a1">&#39;user-agent&#39;</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>            <span style="color:#a6e3a1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">35</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">36</span><span>        url <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#a6e3a1">&#39;/&#39;</span><span style="color:#89dceb;font-weight:bold">.</span>join(m3u8_url<span style="color:#89dceb;font-weight:bold">.</span>split(<span style="color:#a6e3a1">&#39;/&#39;</span>)[:<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#fab387">1</span>]) <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;/&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">37</span><span>        <span style="color:#cba6f7">with</span> <span style="color:#89dceb">open</span>(<span style="color:#a6e3a1">&#39;download/m3u8/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.m3u8&#39;</span>, <span style="color:#a6e3a1">&#39;wb&#39;</span>) <span style="color:#cba6f7">as</span> f:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">38</span><span>            r <span style="color:#89dceb;font-weight:bold">=</span> requests<span style="color:#89dceb;font-weight:bold">.</span>get(m3u8_url, headers<span style="color:#89dceb;font-weight:bold">=</span>headers)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">39</span><span>            f<span style="color:#89dceb;font-weight:bold">.</span>write(r<span style="color:#89dceb;font-weight:bold">.</span>content)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">40</span><span>        urls <span style="color:#89dceb;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">41</span><span>        <span style="color:#cba6f7">for</span> i <span style="color:#89dceb;font-weight:bold">in</span> <span style="color:#89dceb">open</span>(<span style="color:#a6e3a1">&#39;download/m3u8/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.m3u8&#39;</span>, <span style="color:#a6e3a1">&#39;r&#39;</span>):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">42</span><span>            <span style="color:#cba6f7">if</span> <span style="color:#a6e3a1">&#39;#&#39;</span> <span style="color:#89dceb;font-weight:bold">in</span> i:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">43</span><span>                <span style="color:#cba6f7">continue</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">44</span><span>            urls<span style="color:#89dceb;font-weight:bold">.</span>append(i<span style="color:#89dceb;font-weight:bold">.</span>replace(<span style="color:#a6e3a1">&#39;</span><span style="color:#89b4fa">\r</span><span style="color:#a6e3a1">&#39;</span>, <span style="color:#a6e3a1">&#39;&#39;</span>)<span style="color:#89dceb;font-weight:bold">.</span>replace(<span style="color:#a6e3a1">&#39;</span><span style="color:#89b4fa">\n</span><span style="color:#a6e3a1">&#39;</span>, <span style="color:#a6e3a1">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">45</span><span>        <span style="color:#cba6f7">if</span> <span style="color:#89dceb;font-weight:bold">not</span> os<span style="color:#89dceb;font-weight:bold">.</span>path<span style="color:#89dceb;font-weight:bold">.</span>exists(<span style="color:#a6e3a1">&#39;download/temp/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">46</span><span>            os<span style="color:#89dceb;font-weight:bold">.</span>mkdir(<span style="color:#a6e3a1">&#39;download/temp/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">47</span><span>        task_list <span style="color:#89dceb;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">48</span><span>        <span style="color:#cba6f7">for</span> ts_name <span style="color:#89dceb;font-weight:bold">in</span> urls:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">49</span><span>            filename <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#a6e3a1">&#39;download/temp/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> ts_name
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">50</span><span>            task <span style="color:#89dceb;font-weight:bold">=</span> asyncio<span style="color:#89dceb;font-weight:bold">.</span>create_task(
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">51</span><span>                req(session, url <span style="color:#89dceb;font-weight:bold">+</span> ts_name, filename, sem))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">52</span><span>            task_list<span style="color:#89dceb;font-weight:bold">.</span>append(task)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">53</span><span>        responses <span style="color:#89dceb;font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">54</span><span>            <span style="color:#cba6f7">await</span> f <span style="color:#cba6f7">for</span> f <span style="color:#89dceb;font-weight:bold">in</span> tqdm(asyncio<span style="color:#89dceb;font-weight:bold">.</span>as_completed(task_list),
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">55</span><span>                                  total<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#89dceb">len</span>(task_list))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">56</span><span>        ]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">57</span><span>        combine(<span style="color:#a6e3a1">&#39;download/temp/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame, <span style="color:#a6e3a1">&#39;download/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.ts&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">58</span><span>        <span style="color:#6c7086;font-style:italic"># run([</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">59</span><span>        <span style="color:#6c7086;font-style:italic">#     &#39;ffmpeg/bin/ffmpeg.exe&#39;, &#39;-i&#39;, &#39;download/&#39; + medianame + &#39;.ts&#39;, &#39;-c:v&#39;,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">60</span><span>        <span style="color:#6c7086;font-style:italic">#     &#39;copy&#39;, &#39;-c:a&#39;, &#39;copy&#39;, &#39;download/&#39; + medianame + &#39;.mp4&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">61</span><span>        <span style="color:#6c7086;font-style:italic"># ])</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">62</span><span>        <span style="color:#6c7086;font-style:italic"># shutil.rmtree(&#39;download/temp/&#39; + medianame)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">63</span><span>        <span style="color:#6c7086;font-style:italic"># os.remove(&#39;download/&#39; + medianame + &#39;.ts&#39;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">64</span><span>        os<span style="color:#89dceb;font-weight:bold">.</span>remove(<span style="color:#a6e3a1">&#39;download/m3u8/&#39;</span> <span style="color:#89dceb;font-weight:bold">+</span> medianame <span style="color:#89dceb;font-weight:bold">+</span> <span style="color:#a6e3a1">&#39;.m3u8&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">65</span><span>        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">66</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">67</span><span>loop <span style="color:#89dceb;font-weight:bold">=</span> asyncio<span style="color:#89dceb;font-weight:bold">.</span>get_event_loop()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">68</span><span>loop<span style="color:#89dceb;font-weight:bold">.</span>run_until_complete(
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">69</span><span>    download_async(mediaName, m3u8_url, sem_num))</span></span></code></pre></div>
<h2 id="转码成mp4">转码成mp4</h2>
<p>取消掉注释的代码，并修改ffmpeg路径至你的ffmpeg路径，即可自动转化成mp4。</p>

  </content>
  
  
    <p>
      
        <a href="/tags/tutorials/">#Tutorials</a>&nbsp;&nbsp;
      
    </p>
  

    </main>
    <footer>
      
  <span>© 2025 spiritshaman</span>


  <span>
    |
    Made with
    <a href="https://github.com/maolonglong/hugo-simple/">Hugo ʕ•ᴥ•ʔ Simple</a>
  </span>


    </footer>

    
</body>
</html>
